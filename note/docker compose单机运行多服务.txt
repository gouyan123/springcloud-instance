# win7 powershell中 切换到 default虚拟机
docker-machine.exe env default

# 基础环境(mysql...)与服务是分开部署的

# 通过服务编排工具 docker-compose部署基础环境，看deploy/docker-compose-middleware.yml文件；镜像image启动后，变成一个容器container，才能提供服务servic；
# docker-compose-middleware.yml中 environment表示环境变量，ip要换成主机名称hostname；
# elk = elasticsearch搜索 + logstash日志汇总 + kibana为es搜索提供可视化，即各服务将日志发送给logstash组件(或者logstash主动拉取各服务日志)，汇总后logstash
组件将日志存到elasticsearch组件，但是elasticsearch查询组件没有可视化工具，因此引入kibana作为查询可视化工具；
# zipkin：分布式调用 链路追踪，可视化管理工具；
# registry：运行私有仓库，存储公共镜像的地方；
# 运行 docker-compose-middleware.yml文件，使用docker-compose命令运行：
docker-compose.exe -f E:\dongnaoedu\023-应用框架-springcloud综合实例讲解（二）-20170921-tony\程序\springcloud-gogo\deploy\docker-compose-middleware.yml -p dongnao up -d

# 查看当前正在运行的容器：
docker ps -a

# 将各项目打包，切换到 pom.xml文件所在目录：
mvn clean install
# 通过maven插件docker-maven-plugin，打包镜像，并将镜像存到私有仓库(registry)；
# 修改maven的conf/setting.xml文件，servers节点中加入docker私有仓库的用户名和密码信息；
<server>
 <id>docker-aliyun-hub</id>
 <username>admin</username>
 <password>123456</password>
 <configuration>
   <email>2637178209@qq.com</email>
 </configuration>
</server>
# 添加环境变量，设置docker私有仓库地址，可以设置永久的，也可以通过下面命令设置临时的，windows下powershell临时设置，当前窗口有效
$Env:DOCKER_REGISTRY_URL = "192.168.99.100:5000"
# 将指定的服务 构建镜像 并推送到私有仓库，在具体的服务下执行；
mvn docker:build -DpushImage
